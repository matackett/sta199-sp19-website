---
title: "Inference overview"
subtitle: "Part 2"
author: "Dr. Maria Tackett"
date: "03.25.19"
output:
  xaringan::moon_reader:
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    css: "sta199-slides.css"
    logo: img/sta199-sticker-icon.png
    lib_dir: libs
    nature: 
      highlightLines: true
      highlightStyle: github
      countIncrementalSlides: false
---

layout: true

<div class="my-footer">
<span>
<a href="http://datasciencebox.org" target="_blank">datasciencebox.org</a>
</span>
</div> 

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(broom)
library(knitr)
library(DT)
library(emo)
library(openintro)
```


```{r setup, include=FALSE}
# R options
options(
  htmltools.dir.version = FALSE, # for blogdown
  show.signif.stars = FALSE,     # for regression output
  warm = 1
  )
# Set dpi and height for images
knitr::opts_chunk$set(fig.height = 2.5, fig.width = 5, 
                      dpi = 300, 
                      warning = FALSE, 
                      message = FALSE) 
# ggplot2 color palette with gray
color_palette <- list(gray = "#999999", 
                      salmon = "#E69F00", 
                      lightblue = "#56B4E9", 
                      green = "#009E73", 
                      yellow = "#F0E442", 
                      darkblue = "#0072B2", 
                      red = "#D55E00", 
                      purple = "#CC79A7")
htmltools::tagList(rmarkdown::html_dependency_font_awesome())
# For magick
dev.off <- function(){
  invisible(grDevices::dev.off())
}
# For ggplot2
ggplot2::theme_set(ggplot2::theme_bw())
```

---

## Announcements

- HW 04 due Wednesday at 11:59p

- Project proposal due **Friday** at 11:59p


---

## Packages 

```{r}
library(tidyverse)
library(infer)
```

```{r echo=F}
set.seed(03202019)
```

---

## What do you want to do?

- **Estimation** -> Confidence interval

- **Decision** -> Hypothesis test

- First step: Ask the following questions

  1. How many variables?
  2. What types of variables?
  3. What is the research question?
  
---

class: center, middle

# Hypothesis tests

---

## Hypothesis testing

- Set the hypotheses.

- Calculate the observed sample statistic.

- Calculate the p-value.

- Make a conclusion, about the hypotheses, in context of the data and the research question.

- `infer::hypothesize(null = "point")` and 
    - `infer::generate(reps, type = "simulate")`: testing parameter for categorical data 
    - `infer::generate(reps, type = "bootstrap")`: testing parameter for numeric data 
    
- `infer::hypothesize(null = "independence")` and 
`infer::generate(reps, type = "permute")`

---

## Hypothesis testing with numeric data

Let's go back to the price to rent a one-bedroom apartment in Manhattan. 

```{r message=FALSE}
library(tidyverse)
manhattan <- read_csv("data/manhattan.csv")
```

.small[
.pull-left[
```{r}
manhattan %>% slice(1:10)
```
]
.pull-right[
```{r}
manhattan %>% slice(11:20)
```
]
]

---

### Rent in Manhattan vs. the US

```{r}
manhattan %>% 
  summarise(sample_mean = mean(rent))
```

.question[
According a CBS News report, the mean rent for an apartment in the US is $1405. Is the mean rent for a one-bedroom in Manhattan significantly higher than the national average?
]


.footnote[[*U.S. housing rents hit record-high average of $1,405 per month*]( https://www.cbsnews.com/news/u-s-urban-rents-hit-all-time-high-at-average-1405-report/)]

---

### Simulation process

We will use bootstrapping to generate a sampling distribution under the assumption of the null hypothesis being true. Then, calculate the p-value to make a decision on the hypotheses.

1. Take a bootstrap sample - a random sample taken with replacement from the original sample, of the same size as the original sample.

2. Calculate the appropriate statistic of the bootstrap sample.

3. Repeat steps (1) and (2) many times to create a bootstrap distribution - a distribution of bootstrap statistics.

4. Shift the bootstrap distribution to be centered at the null value by subtracting/adding the difference between the center of the bootstrap distribution and the null value to each bootstrap statistic.

5. Calculate the p-value as the proportion of simulations that yield a sample statistic at least as extreme as the observed sample statistic.

---

### Steps 1 - 3: Create bootstrap distribution

.small[
```{r}
rent_bootstrap <- manhattan %>%
  specify(response = "rent") %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "mean")
```
]

```{r echo=F, warning = F, message = F, fig.height = 2.5}
ggplot(data = rent_bootstrap, mapping = aes(x = stat)) +
  geom_histogram() +
  labs(title = "Bootstrap distribution")
```

---

### Bootstrap distribution 

```{r echo=F, warning = F, message = F, fig.height = 2.5}
ggplot(data = rent_bootstrap, mapping = aes(x = stat)) +
  geom_histogram() +
  labs(title = "Bootstrap distribution")
```

.question[What is the center of this distribution? What should the center be under the null hypothesis?]

---

### Step 4: Shift Distribution 

Shift the bootstrap distribution to be centered at the null value by subtracting/adding the difference between the center of the bootstrap distribution and the null value to each bootstrap mean.

```{r}
rent_boot_mean <- rent_bootstrap %>%
  summarise(mean = mean(stat)) %>% pull()
rent_boot_mean
```

```{r}
rent_bootstrap <- rent_bootstrap %>%
  mutate(stat_shifted = stat - (rent_boot_mean - 1405))
```

---

### Step 4: Shift Distribution 

```{r echo=F, warning = F, message = F, fig.height = 3}
ggplot(data = rent_bootstrap, mapping = aes(x = stat_shifted)) +
  geom_histogram() +
  labs(title = "Null distribution") + 
  geom_vline(xintercept = 2625.8, color = "red") 
```

---

### Step 5: Calculate p-value

```{r}
rent_bootstrap %>%
  filter(stat_shifted >= 2625.8) %>%
  summarise(p_value = 2 * (n() / 1000))
```

--

The p-value is less than $\alpha = 0.05$, so we reject the null hypothesis. There is sufficient evidence that the rent for a one-bedroom apartment in Manhattan is higher than the national average.

---

### Hypothesis testing a little quicker

```{r}
boot_means_shifted <- manhattan %>%
  specify(response = rent) %>%
  hypothesize(null = "point", mu = 1405) %>% # hypothesize step #<<
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "mean")
```

---

### Hypothesis testing a little quicker

```{r fig.height = 2.5}
ggplot(data = boot_means_shifted, aes(x = stat)) +
  geom_histogram() + 
  geom_vline(xintercept = 2625.8, color = "red")
```

---

## Hypothesis testing exercises

.question[

.midi[Describe the simulation process for testing for the parameter assigned to your team.]

- .midi[Note any assumptions you make in terms of sample size, observed sample statistic, etc.]
- .midi[Imagine using index cards or chips to represent the data.]
- .midi[Specify whether the null hypothesis would be independence or point.]

> .midi[**M&Ms, stat stars, LAW students, paranormal distribution, WAMS:** single standard deviation]

> .midi[**Fantastic4, JJJB, zuck(R)berg, the 9 lives, BlueTurtle:** single population mean]

> .midi[**EMS, Turquoise, ccbk, Baes 4 Bayes, ShiftHappens:** difference between two population proportions]

> .midi[**Team Audit, PipeOperators, Stats Soulmates, Datan't You Know We're Team 1?, ACOJ:** difference between two population medians]

> .midi[**significantly different, 16EYES, TwoSquared, Motivated Seniors, numero uno:** single population median]
]
---

## Testing errors

- <font class="vocab">Type 1</font>: Reject $H_0$ when you shouldn't have
    + P(Type 1 error) = $\alpha$
    
- <font class="vocab">Type 2</font>: Fail to reject $H_0$ when you should have
    + P(Type 2 error) is harder to calculate, but increases as $\alpha$ decreases

--

.question[
In a court of law

- Null hypothesis: Defendant is innocent
- Alternative hypothesis: Defendant is guilty

Which is worse: Type 1 or Type 2 error?
]

---

## Probabilities of testing errors

- P(Type 1 error) = $\alpha$

- P(Type 2 error) = 1 - Power

- Power = P(correctly rejecting the null hypothesis)

--

.question[
Fill in the blanks in terms of correctly/incorrectly rejecting/failing to reject the null hypothesis:

- $\alpha$ is the probability of ______.
- 1 - Power is the probability of ______.
]

---

## Review

<font class = "vocab">Confidence intervals: </font>
- Bootstrapping
<br> 

<font class="vocab">Hypothesis Testing: </font>
- 1 variable: testing a `point` null
    - categorical data: `simulate` to generate null distribution
    - numeric data: `bootstrap` to generate null distribution 
    
- 2 variables: testing `independence`
    - Use `permute` to generate null distribution

---

### Writing Exercise 3

- Go to [https://app.elireview.com/unit](https://app.elireview.com/unit)

- Include **all** relevant detail in your answer. This is practice for the next week's exam.

- Schedule: 
    - First draft due Tuesday at 11:59p
    - Peer review due Thursday at 11:59p (will have time in lab)
    - Final revision due Sunday at 11:59p


